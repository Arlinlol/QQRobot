<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.cool.qqrobot.dao.RobotDao">
	<!-- 目的：为DAO接口方法提供sql语句配置 -->
	<!-- keyProperty="id" 返回主键给对象属性id -->
	<insert id="addLoginInfo" keyProperty="id">
		insert into robot_user_info(account, gender, nick, lnick, detail)
		values (#{account}, #{gender}, #{nick}, #{lnick}, #{detail});
	</insert>
	
	<resultMap type="AutoReply" id="queryAutoReply">
		<id property="id" column="id"/>
		<result property="account" column="account"/>
		<result property="isAutoReply" column="is_auto_reply"/>
		<result property="isSpecial" column="is_special"/>
		<result property="createTime" column="create_time"/>
		<result property="updateTime" column="update_time"/>
		<collection property="replyNameList" ofType="ReplyName">
			<result property="pid" column="pid"/>
			<result property="markName" column="mark_name"/>
			<result property="type" column="type"/>
		</collection>
	</resultMap>
	<!-- resultMap引用不能漏 -->
	<select id="queryAutoReplyNames" resultType="AutoReply" resultMap="queryAutoReply">
		select
			reply.id,
			reply.account,
			reply.is_auto_reply,
			reply.is_special,
			reply.create_time,
			reply.update_time,
			list.mark_name,
			list.type
		from robot_auto_reply reply left join robot_auto_reply_list list
		on reply.id = list.pid
		where reply.account = #{account}
	</select>
</mapper>
